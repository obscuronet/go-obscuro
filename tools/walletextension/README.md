# Wallet extension

The wallet extension is an HTTP server that sits between the Obscuro client and the Obscuro host. It encrypts outgoing 
requests with the enclave public key, and decrypts any encrypted responses from the enclave (i.e. responses to 
`eth_getBalance` and `eth_getStorageAt` requests) with a _viewing key_.

A _viewing key_ is a public key generated by the wallet extension. The public key is sent to the enclave, accompanied 
by a signature proving the public key was generated by a specific account. The private key is stored locally by the 
wallet extension. This viewing key and its corresponding private key are then used to securely encrypt messages from 
the enclave to the wallet extension.

The signature over the viewing key is created using MetaMask. Currently, other signers are not supported.

The wallet extension should be run locally, such that no sensitive data leaves the client's machine unencrypted.

## Obscuro facade

The Obscuro facade is an additional tool that sits between the wallet extension and a regular Ethereum node. It 
encrypts requests using the enclave public key, and decrypts sensitive responses using the viewing key. In this way, it 
allows the regular Ethereum node to behave like an Obscuro node, in terms of secure messaging.

## Usage

* Start a Geth node that's listening on `ws://localhost:8546`

* Run `walletextension/main/main()` to start the wallet extension and Obscuro facade. The wallet extension will start 
  serving on `http://localhost:3000/`, while the Obscuro facade will be serving on `http://localhost:3001/`

* In MetaMask, configure a new custom network, using `http://localhost:3000/` as the "New RPC URL". Requests and 
  responses for the network will now pass through the wallet extension, with requests encrypted with the enclave 
  public key

  * A viewing key has not yet been set up. The enclave will refuse to respond to `eth_getBalance` and 
      `eth_getStorageAt` requests

* Visit `http://localhost:3000/viewingkeys/` to generate a new viewing key. Sign the viewing key when prompted by 
  MetaMask. Responses to `eth_getBalance` and `eth_getStorageAt` requests will be now be sent encrypted with the 
  viewing key and decrypted automatically by the wallet extension

  * A new viewing key will have to be created each time the wallet extension is started
