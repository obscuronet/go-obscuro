# Wallet extension

The wallet extension is an HTTP server that sits between the Obscuro client and the Obscuro host. It encrypts outgoing 
requests with the enclave public key, and decrypts any encrypted responses from the enclave (i.e. responses to 
`eth_getBalance` and `eth_call` requests) with a _viewing key_.

A _viewing key_ is a public key generated by the wallet extension. The public key is sent to the enclave, accompanied 
by a signature proving the public key was generated by a specific account. The private key is stored locally by the 
wallet extension. This viewing key and its corresponding private key are then used to securely encrypt messages from 
the enclave to the wallet extension.

The signature over the viewing key is created using [MetaMask](https://metamask.io/). Currently, other signers are not 
supported.

The wallet extension should ideally be run locally, such that no sensitive data leaves the client's machine 
unencrypted. If the data is not particularly sensitive, it can also be run in another trusted location.

## Usage

* Install MetaMask in your browser

* Run `walletextension/main/main()` with the following flags to start the wallet extension:

  ```--nodeRPCAddress=<Obscuro node RPC address>```

  The wallet extension is now listening on `http://localhost:3000/`

* In MetaMask, configure a new custom network, using `http://127.0.0.1:3000/` as the "New RPC URL". Requests and 
  responses for the network will now pass through the wallet extension, with requests encrypted with the enclave 
  public key

    * A viewing key has not yet been set up. The enclave will refuse to respond to `eth_getBalance` and 
        `eth_getStorageAt` requests

* Visit `http://localhost:3000/viewingkeys/` to generate a new viewing key. Sign the viewing key when prompted by 
  MetaMask. Responses to `eth_getBalance` and `eth_getStorageAt` requests will be now be sent encrypted with the 
  viewing key and decrypted automatically by the wallet extension

    * Viewing keys are ephemeral. A new viewing key must be created each time the wallet extension is started
