# Deploys a L1 network on Azure for Testnet
# Builds the l1 network image, kills any running container, pushes the image to dockerhub and starts the l1 network on azure
#
# The L1 network is a docker container that runs 3 geth nodes
# It exposes the following ports:
# HTTP:       8025, 8026, 8027
# WebSocket:  9000, 9001, 9002
#
# Exposes the following addresses: (only accessible internally)
#  geth0.testnet.obscu.ro
#  geth1.testnet.obscu.ro
#  geth2.testnet.obscu.ro

name: Manual Deploy L1 network

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Set up Docker
        uses: docker/setup-buildx-action@v1

      - name: Login to DockerHub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Build and push
        uses: docker/build-push-action@v3
        with:
          push: true
          tags: obscuronet/obscuro_testnet_l1network:latest
          file: ./testnet/gethnetwork.Dockerfile
