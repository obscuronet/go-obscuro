# The Obscuro wallet extension

The wallet extension is the Obscuro component that ensures that sensitive information in RPC requests between client
applications and the Obscuro enclave, such as balances or transactions, cannot be eavesdropped on by third parties. It
achieves this goal without requiring any custom wallet software or application code changes. Private keys for Obscuro
addresses may be stored in [MetaMask](https://metamask.io/), for example.

The wallet extension performs two functions:

* Encrypting outgoing RPC requests using the public key of the Obscuro enclave
* Decrypting incoming RPC responses for privacy-sensitive requests (e.g. `eth_getBalance`, `eth_call` and
  `eth_getTransactionReceipt`) using an address-specific _viewing key_

_Viewing keys_ are ephemeral public keys generated by the wallet extension. They are sent to the enclave, accompanied
by a signature proving the viewing key was generated by a specific address, and are used to securely encrypt messages
from the enclave back to the wallet extension. The corresponding private key is stored locally by the wallet extension
to securely decrypt the incoming messages.

The wallet extension should be run locally by the user, such that no sensitive data leaves the client's machine
unencrypted. If the data is not particularly sensitive, it can also be run in another trusted location.

## Pre-requisites

* [MetaMask](https://metamask.io/)
    * MetaMask is required to create a signature over each new viewing key. Other signers are not currently supported
* [Go](https://go.dev/)

## Usage

1. Precompiled binaries for the wallet extension are available for macOS ARM64, macOS AMD64 and Windows AMD64 on the 
   project's [releases page](https://github.com/obscuronet/go-obscuro/releases/)

    * For other OSes and architectures, see `Compiling the binary`, below

2. Start the wallet extension by running the `wallet_extension` binary with the following flags:

   ```--nodeRPCHTTPAddress=<Obscuro host RPC HTTP address> --nodeRPCWebsocketAddress=<Obscuro host RPC websocket address>```

   The wallet extension is now listening on `http://127.0.0.1:3000/`

3. Sign into MetaMask

4. In MetaMask, add a new custom network. Point the network at the wallet extension by using `http://127.0.0.1:3000/` as
   the "New RPC URL", and use `777` as the "Chain ID" (fill in the other parameters as you see fit). Requests and
   responses for the network will now automatically pass through the wallet extension, with all outbound requests
   encrypted with the enclave public key

    * At this stage, no viewing key has been set up. The enclave will refuse to respond to sensitive RPC requests such
      as `eth_getBalance`, `eth_call` and `eth_getTransactionReceipt`

5. Visit `http://localhost:3000/viewingkeys/` to generate a new viewing key. Sign the viewing key when prompted by
   MetaMask. Responses to sensitive RPC requests will be now be encrypted with the viewing key and decrypted
   automatically by the wallet extension

    * Viewing keys are ephemeral. A new viewing key must be created each time the wallet extension is started

# Compiling the binary

The wallet extension binary can be built by cloning the [Obscuro repository](https://github.com/obscuronet/go-obscuro) 
and running the following commands from the root of the repository:

```
cd tools/walletextension/main
go build -o wallet_extension .
```

This will build the wallet extension binary under `tools/walletextension/main/wallet_extension`
